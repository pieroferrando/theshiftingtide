<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Shifting Tide</title>
  <meta name="description" content="Essays on history, money, and the shifting world order." />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="wrap">
      <h1 class="brand">The Shifting Tide</h1>
      <nav class="nav">
        <a class="nav-link" href="/main-article/" aria-label="Read the Main Article">Main Article</a>
        <a class="nav-link" href="https://theshiftingtide.substack.com/" target="_blank" rel="noopener">Substack</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="intro">
      <h2 class="tagline">Essays on history, money, and the shifting world order.</h2>
    </section>

    <section id="posts" class="grid" aria-live="polite"></section>

    <section class="more">
      <a class="btn" href="https://theshiftingtide.substack.com/archive" target="_blank" rel="noopener">
        Browse the full archive →
      </a>
    </section>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <small>© <span id="year"></span> The Shifting Tide</small>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    async function loadPosts(){
      const el = document.getElementById('posts');
      try{
        const r = await fetch('/posts.json', { cache: 'no-store' });
        if(!r.ok) throw new Error('posts.json not found');
        const items = await r.json();
        el.innerHTML = items.map(it => {
          const date = new Date(it.date).toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'});
          const img = it.image ? `<img src="${it.image}" alt="" loading="lazy" class="card-img">` : '';
          const sub = it.subtitle ? `<p class="card-sub">${it.subtitle}</p>` : '';
          return `
            <article class="card">
              <a class="card-link" href="${it.url}" target="_blank" rel="noopener">
                ${img}
                <div class="card-body">
                  <h3 class="card-title">${it.title}</h3>
                  ${sub}
                  <p class="card-meta">${date}</p>
                </div>
              </a>
            </article>`;
        }).join('');
      }catch(e){
        el.innerHTML = `<p class="error">Couldn’t load posts. <a href="https://theshiftingtide.substack.com/">See Substack</a>.</p>`;
        console.error(e);
      }
    }
    loadPosts();
  </script>
</body>
</html>
